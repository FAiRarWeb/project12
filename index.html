<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MindAR AR Responsive</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

  <!-- Libraries -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: black;
      position: fixed;
      top: 0;
      left: 0;
    }

    /* Red corner borders */
    body::after {
      content: "";
      position: fixed;
      top: 50%;
      left: 50%;
      width: 50%;
      height: 71%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 15;
      border: none;
      background: 
        linear-gradient(to right, #ff0000 0%, #ff0000 40px, transparent 40px),
        linear-gradient(to bottom, #ff0000 0%, #ff0000 40px, transparent 40px),
        linear-gradient(to left, #ff0000 0%, #ff0000 40px, transparent 40px),
        linear-gradient(to bottom, #ff0000 0%, #ff0000 40px, transparent 40px),
        linear-gradient(to right, #ff0000 0%, #ff0000 40px, transparent 40px),
        linear-gradient(to top, #ff0000 0%, #ff0000 40px, transparent 40px),
        linear-gradient(to left, #ff0000 0%, #ff0000 40px, transparent 40px),
        linear-gradient(to top, #ff0000 0%, #ff0000 40px, transparent 40px);
      background-size: 
        40px 3px, 3px 40px,
        40px 3px, 3px 40px,
        40px 3px, 3px 40px,
        40px 3px, 3px 40px;
      background-position: 
        0 0, 0 0,
        100% 0, 100% 0,
        0 100%, 0 100%,
        100% 100%, 100% 100%;
      background-repeat: no-repeat;
      animation: recordingPulse 2s infinite;
    }
    @keyframes recordingPulse {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }

    .control-button, .google-button {
      position: absolute;
      z-index: 20;
      font-weight: bold;
      cursor: pointer;
      border-radius: 8px;
      padding: 10px 15px;
      display: none;
    }

    .animate-button { bottom: 20px; right: 20px; }
    .info-button { bottom: 80px; right: 20px; }

    .google-button {
      width: 80px; height: 80px;
      top: 25px; left: 25px;
      background: transparent; border: none;
    }
    .google-button img { width: 100%; height: 100%; object-fit: contain; }
  </style>
</head>

<body>
  <a-scene
    mindar-image="imageTargetSrc: https://FAiRarWeb.github.io/project123/targets.mind;
                  uiScanning: true;
                  filterMinCF: 0.0005; 
                  filterBeta: 0.0015; 
                  missTolerance: 5; 
                  warmupTolerance: 2;
                  maxTrack: 2;"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"
    renderer="precision: high; antialias: true; colorManagement: true"
    embedded
  >
    <a-assets>
      <video id="video1" src="https://FAiRarWeb.github.io/project/videoAR3.mp4" preload="auto" loop crossorigin="anonymous"></video>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0" videohandler>
      <a-video src="#video1" width="1" height="0.45" visible="false"></a-video>
    </a-entity>

    <a-entity mindar-image-target="targetIndex: 1" videohandler>
      <a-video src="#video1" width="1" height="0.45" visible="false"></a-video>
    </a-entity>
  </a-scene>

  <button id="animateButton" class="control-button animate-button">Animate Me</button>
  <button id="infoButton" class="control-button info-button">Info</button>
  <button id="googleButton" class="google-button" onclick="window.open('https://creativeculture.my/fair/', '_blank')">
    <img src="https://FAiRarWeb.github.io/project/buaya2.png" alt="Info" />
  </button>

  <script>
    function getBorderBounds() {
      const vw = window.innerWidth, vh = window.innerHeight;
      return { left: vw*0.25, right: vw*0.75, top: vh*0.145, bottom: vh*0.855 };
    }

    function isTargetInBorder(corners) {
      if (!corners) return false;
      let cx=0, cy=0;
      for (let i=0;i<corners.length;i+=2){ cx+=corners[i]; cy+=corners[i+1]; }
      cx/=4; cy/=4;
      const sx = cx*window.innerWidth, sy = cy*window.innerHeight;
      const b = getBorderBounds();
      return sx>=b.left && sx<=b.right && sy>=b.top && sy<=b.bottom;
    }

    AFRAME.registerComponent("videohandler", {
      init: function () {
        const videoEl = document.querySelector("#video1");
        const animateButton = document.querySelector("#animateButton");
        const infoButton = document.querySelector("#infoButton");
        const googleButton = document.querySelector("#googleButton");
        const videoPlane = this.el.querySelector("a-video");
        let visible = false;

        this.el.addEventListener("targetFound", e => { visible = true; });
        this.el.addEventListener("targetLost", e => {
          visible = false;
          videoPlane.setAttribute("visible", false);
          videoEl.pause();
          animateButton.style.display = "none";
          infoButton.style.display = "none";
          googleButton.style.display = "none";
        });

        this.el.sceneEl.addEventListener("arFrame", e => {
          if (!visible) return;
          const target = e.detail?.target;
          if (target && isTargetInBorder(target.corners)) {
            animateButton.style.display = "block";
            infoButton.style.display = "block";
          } else {
            animateButton.style.display = "none";
            infoButton.style.display = "none";
            googleButton.style.display = "none";
          }
        });
      }
    });
  </script>
</body>
</html>
